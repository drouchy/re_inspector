#!/bin/sh -e

APP_DIR="`pwd`/tmp"
mkdir -p $APP_DIR

export PATH=${APP_DIR}/elixir/bin:$PATH

if ! [ `which mix` ] ; then
  mkdir -p ${APP_DIR}/elixir
  curl -L https://github.com/elixir-lang/elixir/releases/download/v0.14.3/Precompiled.zip > ${APP_DIR}/elixir.zip
  unzip -u ${APP_DIR}/elixir.zip -d ${APP_DIR}/elixir
fi

curl -L https://github.com/ericmj/hex/archive/v0.3.2.zip > ${APP_DIR}/hex.zip
unzip -u ${APP_DIR}/hex.zip -d ${APP_DIR}
cd ${APP_DIR}/hex-0.3.2
mix do archive.build, archive.install --force
cd -

if ! [ `which rebar` ] ; then
  curl -L https://github.com/rebar/rebar/wiki/rebar > ${APP_DIR}/elixir/bin/rebar
  chmod +x ${APP_DIR}/elixir/bin/rebar
fi

iex --version